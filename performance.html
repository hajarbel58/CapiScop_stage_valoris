<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Performance ASFIM</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

<style>
html, body {height:100%; margin:0; font-family:'Poppins', sans-serif; background:#f0f2f5; color:#333;}
.main-wrapper {display:flex; flex:1;}
.sidebar {
    position: fixed; top:0; left:0; width:220px; height:100%;
    background: linear-gradient(180deg, #0f2027, #203a43); color:#fff;
    display:flex; flex-direction:column; padding-top:60px; transition: transform 0.3s ease; overflow:hidden; z-index:1001;
}
.sidebar.collapsed { transform: translateX(-100%); }
.sidebar .logo { font-weight:800; font-size:1.8rem; text-align:center; padding:20px 0; color:#66bacf; }
.sidebar ul { list-style:none; padding:0; margin:0; flex:1; }
.sidebar ul li { padding:15px 20px; }
.sidebar ul li a { text-decoration:none; color:#a0aec0; display:flex; align-items:center; gap:10px; transition:0.3s ease; }
.sidebar ul li a:hover { background-color: rgba(102,186,207,0.2); color:#66bacf; border-radius:8px; }

.topbar {
    position: fixed; left:0; right:0; top:0; height:60px;
    background: rgba(15,32,39,0.95); display:flex; justify-content:space-between; align-items:center; padding:0 20px;
    box-shadow:0 2px 8px rgba(0,0,0,0.3); z-index:1002;
}
.topbar .toggle-btn { font-size:1.5rem; color:#66bacf; cursor:pointer; }
.topbar .profile { display:flex; align-items:center; gap:10px; position:relative; cursor:pointer; }
.topbar .profile i { font-size:28px; color:#66bacf; }
.topbar .profile span { font-weight:600; color:#fff; }
.topbar .dropdown { position:absolute; top:50px; right:0; background:#1c2b38; border-radius:8px; display:none; flex-direction:column; overflow:hidden; box-shadow:0 6px 15px rgba(0,0,0,0.4);}
.topbar .dropdown a { padding:12px 20px; color:#e0e7ff; text-decoration:none; transition:0.3s ease; }
.topbar .dropdown a:hover { background-color:#2a3a48; color:#66bacf; }
.topbar .dropdown.show { display:flex; }

.main-content { flex:1; margin-left:220px; padding:80px 30px 30px; transition:margin-left 0.3s ease; display:flex; flex-direction:column; }
.main-content.collapsed { margin-left:0; }
.container-performance { width:100%; max-width:1200px; margin:auto; background:#fff; padding:30px; border-radius:1rem; box-shadow:0 6px 20px rgba(0,0,0,0.2); }

h2 { text-align:center; color:#0d6efd; margin-bottom:20px; }
#customSearchBox { margin-bottom:20px; }

.table-responsive { max-width:100%; overflow-x:auto; }
table.dataTable thead th { background:#539cb0; color:#fff; }
table.dataTable tbody tr:hover { background-color:#e0f0ff; }

.btn-download { background:#539cb0; color:#fff; font-weight:600; border-radius:8px; transition:0.3s ease; }
.btn-download:hover { background:#0666c0; color:#fff; transform:scale(1.03); }

footer { text-align:center; padding:1.5rem; color:#bbbfc2; font-size:0.85rem; background-color:#1c2b38; margin-top:auto; border-radius:8px; margin-top:20px; }
</style>
</head>
<body>

<div class="sidebar" id="sidebar">
    <div class="logo">CapiScop</div>
    <ul>
        <li><a href="#"><i class='bx bx-home'></i> <span>Accueil</span></a></li>
        <li><a href="{{ url_for('performance') }}"><i class='bx bx-line-chart'></i> <span>Performance</span></a></li>
        <li><a href="#"><i class='bx bx-folder'></i> <span>Fichiers</span></a></li>
    </ul>
</div>

<div class="main-wrapper">
    <div class="topbar" id="topbar">
        <div>
            <span class="toggle-btn" id="toggleBtn"><i class='bx bx-menu'></i></span>
        </div>
        <div class="profile" id="profileMenu">
            {% if session['gender'] == 'femme' %}
                <i class="fas fa-user-female"></i>
            {% else %}
                <i class="fas fa-user"></i>
            {% endif %}
            <span>{{ session['username'] }}</span>
            <div class="dropdown" id="dropdownMenu">
                <a href="#">Mon Profil</a>
                <a href="#">Paramètres</a>
                <a href="/logout">Déconnexion</a>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="container-performance">
            <h2>Tableau de Performances ASFIM</h2>

            {% if table_date %}
            <p style="text-align:center; color:#0d6efd; font-weight:600; margin-bottom:15px;">
                Date du tableau : {{ table_date }}
            </p>
            {% endif %}

            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
                {% for category, message in messages %}
                  <div class="alert alert-{{ category }} text-center">{{ message }}</div>
                {% endfor %}
              {% endif %}
            {% endwith %}

            {% if table_html %}
                <input type="text" id="customSearchBox" class="form-control" placeholder="Rechercher par nom OPCVM...">
                <div class="table-responsive">
                    {{ table_html|safe }}
                </div>
                <a href="{{ url_for('download_performance') }}" class="btn btn-download mt-3">Télécharger le fichier</a>
            {% else %}
                <p>Aucun fichier disponible.</p>
            {% endif %}
        </div>

        <footer>&copy; 2025 CapiScop - Tous droits réservés</footer>
    </div>
</div>

<script>
const toggleBtn = document.getElementById('toggleBtn');
const sidebar = document.getElementById('sidebar');
const mainContent = document.getElementById('mainContent');

// Toggle sidebar
toggleBtn.addEventListener('click', () => {
    sidebar.classList.toggle('collapsed');
    mainContent.classList.toggle('collapsed');
});

// Dropdown profil
const profileMenu = document.getElementById('profileMenu');
const dropdownMenu = document.getElementById('dropdownMenu');
profileMenu.addEventListener('click', (e) => { e.stopPropagation(); dropdownMenu.classList.toggle('show'); });
document.addEventListener('click', () => { dropdownMenu.classList.remove('show'); });
$(document).ready(function() {
    var table = $('table').DataTable({
        "paging": true,
        "ordering": true,
        "info": true,
        "searching": true  // <-- activer recherche DataTables
    });

    var opcvmIndex = -1;
    $('table thead th').each(function(i){
        if($(this).text().trim().toUpperCase() === "OPCVM") opcvmIndex = i;
    });

    if(opcvmIndex >= 0){
        $('#customSearchBox').on('keyup', function() {
            table.column(opcvmIndex).search(this.value).draw();
        });
    }
});

</script>

</body>
</html>
